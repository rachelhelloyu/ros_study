<launch>
  <arg name="robot_name_1" default="tbmn_01" />
  <arg name="robot_name_2" default="tbmn_02" /> 

  <include file="$(find tianbot_mini)/launch/simulation.launch" >
    <arg name="robot_name" value="$(arg robot_name_1)" />
  </include>
  <include file="$(find abc_swarm)/launch/spawn_robot.launch">
    <arg name="robot_name" value="$(arg robot_name_2)" />
    <!--the position is controlled by the static transform-->
    <arg name="initial_pose_x" default="-0.5"/>
  </include>
  <!-- map file -->
  <arg name="map" default="$(find tianbot_mini)/maps/map.yaml" />
  <!-- Rviz -->
  <arg name="use_rviz" default="true" />

  <group ns="$(arg robot_name_1)">
    <include file="$(find tianbot_mini)/launch/simulation.launch" >
      <arg name="robot_name" value="$(arg robot_name_1)" />
    </include>
    <!-- Map服务器，加载*.yaml地图 -->
    <node pkg="map_server" type="map_server" name="map_server" args="$(arg map)">
      <param name="frame_id" value="$(arg robot_name_1)/map" />
    </node>
    <include file="$(find abc_swarm)/launch/amcl.launch">
      <arg name="initial_pose_x"  default="1.0"/>
      <arg name="initial_pose_y"  default="-0.5"/>
      <arg name="initial_pose_a"  default="0.0"/>
      <arg name="global_frame_id" default="$(arg robot_name)/map" />
      <arg name="base_frame_id" default="$(arg robot_name)/base_link" />
      <arg name="odom_frame_id" default="$(arg robot_name)/odom" />
      <arg name="scan_topic" default="scan" />
      <arg name="odom_topic" default="odom" />
      <arg name="cmd_vel_topic" default="cmd_vel" />
    </include>
    <!-- RVIZ可视化调试工具 -->
    <node if="$(arg use_rviz)" name="rviz" pkg="rviz" type="rviz" args="-d $(find tianbot_mini)/rviz/amcl.rviz -f $(arg global_frame_id)" >
        <remap from="/move_base_simple/goal" to="move_base_simple/goal"/>
        <remap from="/initialpose" to="initialpose"/>
    </node>
  </group>

  <group ns="$(arg robot_name_2)">
    <include file="$(find abc_swarm)/launch/spawn_robot.launch">
      <arg name="robot_name" value="$(arg robot_name_2)" />
      <!--the position is controlled by the static transform-->
      <arg name="initial_pose_x" default="-0.5"/>
    </include>
    <!-- Map服务器，加载*.yaml地图 -->
    <node pkg="map_server" type="map_server" name="map_server" args="$(arg map)">
      <param name="frame_id" value="$(arg robot_name_2)/map" />
    </node>
    <include file="$(find abc_swarm)/launch/amcl.launch">
      <arg name="initial_pose_x"  default="1.0"/>
      <arg name="initial_pose_y"  default="0.5"/>
      <arg name="initial_pose_a"  default="0.0"/>
      <arg name="global_frame_id" default="$(arg robot_name)/map" />
      <arg name="base_frame_id" default="$(arg robot_name)/base_link" />
      <arg name="odom_frame_id" default="$(arg robot_name)/odom" />
      <arg name="scan_topic" default="scan" />
      <arg name="odom_topic" default="odom" />
      <arg name="cmd_vel_topic" default="cmd_vel" />
    </include>
    <!-- RVIZ可视化调试工具 -->
    <node if="$(arg use_rviz)" name="rviz" pkg="rviz" type="rviz" args="-d $(find abc_swarm)/rviz/demo_two_robots_navigation.rviz" >
        <remap from="/move_base_simple/goal" to="move_base_simple/goal"/>
        <remap from="/initialpose" to="initialpose"/>
    </node>
  </group>

    
</launch>